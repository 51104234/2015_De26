jQuery(document).ready(function() {

	$(".alert-mail").hide();
    $(".mail-info").on("click", function() 
    {
        $(".alert-info").slideToggle(400);
    }); 

    $(".inputs-avarta").hide();
    $(".remove-avarta").hide();
    $(".upload-avarta").hide();
    $(".avarta-progress").hide();

    $(".select-avarta").click(function() {
        $(".inputs-avarta").click();
    });

    $(".remove-avarta").click(function() {
        $(this).hide();
        $(".upload-avarta").hide()
        $(".select-avarta").fadeIn();
        $(".display-select-file").hide();
        $(".display-select-name").hide();
        $(".display-select-name").html("");
    });

    function displaySelectImage(input) 
    {
        if (input.files && input.files[0]) 
        {
            var reader = new FileReader();
            reader.onload = function (e) 
            {
                $(".display-select-file > img").attr('src', e.target.result);
            }
            reader.readAsDataURL(input.files[0]);
        }
    }

    $(".inputs-avarta").change(function() {
        displaySelectImage(this)
        $(".display-select-name").html("");
        for (var i = 0; i < this.files.length; i++) {
            $(".display-select-file").show();
            $(".display-select-name").append('<div class="alert alert-info">' + this.files[i].name + '</div>').show();
            $(".remove-avarta").show();
            $(".select-avarta").hide();
            $(".upload-avarta").show();
        }
    });

    $(".formProfile").ajaxForm({
        resetForm: true,
        beforeSubmit: function() 
        {
            if (window.File && window.FileReader && window.FileList && window.Blob)
            {
                var fsize = $(".inputs-avarta")[0].files[0].size;
                var ftype = $(".inputs-avarta")[0].files[0].type; 
                switch(ftype)
                {
                    case 'image/png': 
                    case 'image/gif': 
                    case 'image/jpeg': 
                    case 'image/jpg':
                    break;
                    default:
                        $(".display-select-name").html("<div class='alert alert-danger'>Not supported file type!</div>").slideDown();
                    return false
                }
                if(fsize>5242880) 
                {
                 alert("<b>" + fsize + "</b> Too big file! <br />File is too big, it should be less than 5 MB.");
                 return false
                }
            }
            else
            {
                alert("Please upgrade your browser.");
                   return false
            }
            $(".avarta-progress").show();
        },
        uploadProgress:function(event,position,total,percentComplete)
        {
            $(".avarta-progress-bar").width(percentComplete + '%');
        },
        success:function() 
        {
            $(".remove-avarta").hide();
            $(".upload-avarta").hide();
            $(".select-avarta").show();
            $(".avarta-progress").hide()
            $(".display-select-name").hide();
            $(".display-select-file").hide();
            $(".display-select-name").html("");
            $(".avarta-progress-bar").width(0);
        },
        complete: function(response,responseText)
        {
            console.log(response.responseText);
            $('.display-avarta').html('<img class="img-thumbnail" alt="' + response.responseText + '" src="uploads/users/album/' + response.responseText + '">');
            $(".display-select-name").html("<div class='alert alert-info'>Upload successful!</div>").fadeIn();
           
        }
    });

});	